<?php
if(Mage::getStoreConfig('abtester/general/enable') == 1):
	$account_id =  Mage::getStoreConfig('abtester/general/accountid');
	if($account_id != '' && is_numeric($account_id)):
		$account_id =  Mage::getStoreConfig('abtester/general/accountid');
?>
    <?php
     if (Mage::getStoreConfig('abtester/general/detailedurl')):
    ?>
<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
      var _vwo_url_prefix = '/ctrl_<?php echo $this->getRequest()->getControllerName(); ?>/act_<?php echo $this->getRequest()->getActionName(); ?>/rt_<?php echo $this->getRequest()->getRouteName(); ?>/mod_<?php echo $this->getRequest()->getModuleName(); ?>';
      var _vis_opt_url = document.location.origin + _vwo_url_prefix + document.location.pathname + document.location.search;
</script>
    <?php endif; ?>


<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=<?php echo $account_id; ?>,
_vis_opt_url = window._vis_opt_url || document.URL,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
code_source='magento',
// DO NOT EDIT BELOW THIS LINE
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(_vis_opt_url)+'&s='+code_source+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();

<?php 
		if(Mage::getStoreConfig('abtester/revenue_options/enable') == 1):
			$revenue_opt = Mage::getStoreConfig('abtester/revenue_options/mode');
			if($revenue_opt == "key1"):
				$revenue_amount = $this->getTotalRevenue();
			elseif($revenue_opt == "key2"):
				$revenue_amount  = $this->getTotalWithoutShipping();
			elseif($revenue_opt == "key3"):
				$revenue_amount = $this->getTotalWithoutShippingTax();
			endif;
?>

var _vis_opt_revenue = <?php echo $revenue_amount ; ?> ;
window._vis_opt_queue = window._vis_opt_queue || [];
window._vis_opt_queue.push(function() {_vis_opt_revenue_conversion(_vis_opt_revenue);});	

<?php endif; ?>
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

<?php
endif;endif; ?>
